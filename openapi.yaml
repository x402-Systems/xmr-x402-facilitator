openapi: 3.1.0
info:
  title: Universal Monero x402 Facilitator
  description: >
    A x402-compliant sidecar daemon for Monero (XMR).
    Standardizes Monero payments for AI agents and the Agentic Web.
  version: 1.1.0
servers:
  - url: http://localhost:3113

paths:
  /supported:
    get:
      summary: Get supported networks
      responses:
        '200':
          description: Supported network kinds
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupportedResponse'

  /settle:
    post:
      summary: Settle a payment
      description: Verifies cryptographic proof (tx_key) and settles the transaction on-chain.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/X402Request'
      responses:
        '200':
          description: Settlement successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettleResponse'

  /verify:
    post:
      summary: Verify a payment signature
      description: Lightweight check to see if a payment is valid without finalizing settlement.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/X402Request'
      responses:
        '200':
          description: Verification result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VerifyResponse'

  /invoices:
    post:
      summary: (Helper) Create new invoice
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                amount_usd:
                  type: number
      responses:
        '200':
          description: Invoice created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvoiceResponse'

components:
  schemas:
    X402Request:
      type: object
      required: [paymentPayload, paymentRequirements]
      properties:
        paymentPayload:
          type: object
          properties:
            address: { type: string }
            tx_id: { type: string }
            tx_key: { type: string }
        paymentRequirements:
          type: object
          properties:
            scheme: { type: string, example: "exact" }
            network: { type: string, example: "monero:mainnet" }

    SupportedResponse:
      type: object
      properties:
        kinds:
          type: array
          items:
            type: object
            properties:
              x402Version: { type: integer, example: 2 }
              scheme: { type: string, example: "exact" }
              network: { type: string, example: "monero:mainnet" }

    VerifyResponse:
      type: object
      properties:
        isValid: { type: boolean }
        invalidReason: { type: string }

    SettleResponse:
      type: object
      properties:
        success: { type: boolean }
        transaction: { type: string }
        network: { type: string }
        payer: { type: string, example: "anonymous" }

    InvoiceResponse:
      type: object
      properties:
        address: { type: string }
        amount_piconero: { type: integer }
        invoice_id: { type: string }
        status: { type: string }
        network: { type: string }
